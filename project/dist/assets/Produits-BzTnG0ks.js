import{r as l,u as F,j as e}from"./index-yrzGcrsz.js";import{p as m}from"./produitApi-qwVbZCBa.js";import{c as A}from"./CategorieApi-NIYRnbMd.js";import{P as Q,M as D}from"./Modal-CRmXHlMq.js";import{B as h}from"./Button-CeNaAo-j.js";import{L as T}from"./LoadingSpinner-xF3CygPc.js";import{V as o}from"./index-CyOt5fqF.js";import{u as R}from"./useQuery-CZB9O9Qr.js";import{u as f}from"./useMutation-DpsCt41A.js";import{S as B}from"./search-B1HlV7q8.js";import{S as O}from"./square-pen-CXHSDyXI.js";import{T as z}from"./trash-2-DLPNPXD6.js";import"./axiosInstance-Cz6MWCIH.js";const re=()=>{const[x,S]=l.useState(""),[P,b]=l.useState(!1),[n,p]=l.useState(null),[t,i]=l.useState({name:"",price_buy:0,price_sell:0,quantityStock:0,categorie:null,reference:""}),g=F(),{data:d=[],isLoading:w,error:C}=R({queryKey:["categories"],queryFn:()=>A.getAll().then(r=>r.data)}),[k,q]=l.useState({}),[M,y]=l.useState(!0);l.useEffect(()=>{const r=async()=>{y(!0);try{const a={};for(const c of d){const s=await m.getByCategorie(c.id);a[c.nom]=s.data}q(a)}catch{o.error("Erreur lors du chargement des produits")}finally{y(!1)}};d.length>0&&r()},[d]);const j=f({mutationFn:m.create,onSuccess:()=>{g.invalidateQueries(["categories"]),o.success("Produit créé avec succès"),u()},onError:()=>o.error("Erreur lors de la création du produit")}),v=f({mutationFn:({id:r,...a})=>m.update(r,a),onSuccess:()=>{g.invalidateQueries(["categories"]),o.success("Produit modifié avec succès"),u()},onError:()=>o.error("Erreur lors de la modification du produit")}),_=f({mutationFn:m.delete,onSuccess:()=>{g.invalidateQueries(["categories"]),o.success("Produit supprimé avec succès")},onError:()=>o.error("Erreur lors de la suppression du produit")}),N=(r=null)=>{r?(p(r),i({name:r.name,reference:r.reference||"",price_buy:r.price_buy||0,price_sell:r.price_sell||0,quantityStock:r.quantityStock||0,categorie:r.categorie?.id||null})):(p(null),i({name:"",reference:"",price_buy:0,price_sell:0,quantityStock:0,categorie:""})),b(!0)},u=()=>{b(!1),p(null),i({name:"",reference:"",price_buy:0,price_sell:0,quantityStock:0,categorie:""})},E=r=>{r.preventDefault();const a={...t,categorie:{id:t.categorie}};n||delete a.reference,n?v.mutate({id:n.id,...a}):j.mutate(a)},L=r=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")&&_.mutate(r)};return w||M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{size:"lg"})}):C?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-red-600",children:"Erreur lors du chargement des catégories"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Produits"}),e.jsx("p",{className:"text-gray-600",children:"Liste des produits par catégorie"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:max-w-sm",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:x,onChange:r=>S(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs(h,{onClick:()=>N(),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Nouveau produit"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(k).map(([r,a])=>{const c=a.filter(s=>s.name.toLowerCase().includes(x.toLowerCase())||s.reference?.toLowerCase().includes(x.toLowerCase()));return e.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-blue-700",children:r}),c.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit trouvé"}):c.map(s=>e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-4 last:mb-0 last:pb-0 last:border-none",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Réf: ",s.reference]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>N(s),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors","aria-label":"Modifier produit",title:"Modifier",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Supprimer produit",title:"Supprimer",children:e.jsx(z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Prix d'achat : ",e.jsxs("span",{className:"text-orange-600 font-semibold",children:[s.price_buy," MAD"]}),e.jsx("br",{}),"Prix de vente : ",e.jsxs("span",{className:"text-green-600 font-semibold",children:[s.price_sell," MAD"]}),e.jsx("br",{}),"Quantité de stock : ",e.jsx("span",{className:"text-blue-600 font-semibold",children:s.quantityStock})]})]},s.id))]},r)})}),e.jsx(D,{isOpen:P,onClose:u,title:n?"Modifier le produit":"Nouveau produit",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Référence"}),e.jsx("input",{type:"text",disabled:!0,value:t.reference,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:r=>i({...t,name:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prix d'achat"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:t.price_buy,onChange:r=>i({...t,price_buy:parseFloat(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prix de vente"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:t.price_sell,onChange:r=>i({...t,price_sell:parseFloat(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantité en stock"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"1",value:t.quantityStock,onChange:r=>i({...t,quantityStock:parseInt(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catégorie"}),e.jsxs("select",{required:!0,value:t.categorie||"",onChange:r=>i({...t,categorie:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Sélectionnez une catégorie --"}),d.map(r=>e.jsx("option",{value:r.id,children:r.nom},r.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:u,children:"Annuler"}),e.jsx(h,{type:"submit",loading:j.isLoading||v.isLoading,children:n?"Modifier":"Créer"})]})]})})]})};export{re as default};
