import{d as g,r as i,u as V,j as e,L as R,a as d,P as _,V as I}from"./index-tLwmzl-Q.js";import{p as Q}from"./produitApi-rf_H1KRd.js";import{c as z}from"./CategorieApi-BuXoDlXi.js";import{M as T}from"./Modal-D33wMkEt.js";import{B as x}from"./Button-Lskl0WlK.js";import{u as m}from"./useQuery-BLmLD0fm.js";import{A as E}from"./alert-triangle-DIuKnEI1.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h=g("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),W=()=>{const[l,j]=i.useState(0),[n,N]=i.useState(10),[f,$]=i.useState(!1),[a,c]=i.useState({produitId:"",pointVenteId:"",quantite:0}),y=V(),{data:r=[],isLoading:v}=m({queryKey:["allProduits"],queryFn:()=>Q.getAll().then(s=>s.data),staleTime:300*1e3}),{data:k=[],isLoading:w}=m({queryKey:["pointsVente"],queryFn:()=>_.getAllPointsVente().then(s=>s.data)}),{data:S=[],isLoading:q}=m({queryKey:["categories"],queryFn:()=>z.getAll().then(s=>s.data)}),A=s=>{if(s.preventDefault(),!a.produitId||!a.pointVenteId||a.quantite<=0){I.error("Veuillez remplir tous les champs correctement");return}reapprovisionnementMutation.mutate(a)},o=s=>s<=l?{color:"text-red-600 bg-red-100",label:"Rupture"}:s>l&&s<=n?{color:"text-amber-600 bg-amber-100",label:"Faible"}:{color:"text-green-600 bg-green-100",label:"Normal"},P=r.filter(s=>s.quantityStock<=l).length,F=r.filter(s=>s.quantityStock>l&&s.quantityStock<=n).length,M=r.length,C=S.map(s=>{const t=(s.produits||[]).reduce((D,L)=>D+(L.quantityStock||0),0);return{id:s.id,nom:s.nom,quantite:t}}),u=r.filter(s=>s.quantityStock>n),b=r.filter(s=>s.quantityStock>l&&s.quantityStock<=n),p=r.filter(s=>s.quantityStock<=l);return v||w||q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(R,{size:"lg"})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .hide-scrollbar::-webkit-scrollbar { display: none; }
          .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        `}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des produits"}),e.jsx("p",{className:"text-gray-600",children:"Liste et statistiques des produits"})]}),e.jsxs(x,{onClick:()=>y.invalidateQueries(["allProduits"]),className:"bg-blue-700 text-blue-800  hover:bg-teal-500 flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),"Actualiser le stock"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(d,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Valeur d'achat du stock"}),e.jsxs("p",{className:"text-xl font-semibold text-orange-700",children:[r.reduce((s,t)=>s+t.price_buy*t.quantityStock,0).toFixed(2)," MAD"]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(d,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Estimation de vente du stock"}),e.jsxs("p",{className:"text-xl font-semibold text-green-700",children:[r.reduce((s,t)=>s+t.price_sell*t.quantityStock,0).toFixed(2)," MAD"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(d,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Produits"}),e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:M})]})]}),e.jsxs("div",{className:"bg-amber-100 shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-amber-200 p-3 rounded-lg",children:e.jsx(E,{className:"h-6 w-6 text-amber-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700 text-sm",children:"Stock faible"}),e.jsx("p",{className:"text-xl font-semibold text-amber-800",children:F})]})]}),e.jsxs("div",{className:"bg-red-50 shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-red-100 p-3 rounded-lg",children:e.jsx(K,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-700 text-sm",children:"Ruptures"}),e.jsx("p",{className:"text-xl font-semibold text-red-800",children:P})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-700 mt-8 mb-4",children:"Stock total par catégorie"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:C.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.nom}),e.jsx("p",{className:"text-sm text-gray-500",children:"Quantité totale en stock"})]}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:s.quantite})]},s.id))})]}),e.jsxs("div",{className:"flex gap-6 mb-6 p-2 bg-white border border-gray-300 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold text-amber-700 mb-1",children:"Seuil stock faible"}),e.jsx("input",{type:"number",min:l+1,value:n,onChange:s=>N(Math.max(l+1,Number(s.target.value))),className:"border border-gray-300 rounded px-3 py-1 w-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold text-red-700 mb-1",children:"Seuil rupture de stock"}),e.jsx("input",{type:"number",min:0,value:l,onChange:s=>j(Math.max(0,Number(s.target.value))),className:"border border-gray-300 rounded px-3 py-1 w-32"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-green-700",children:"Stock Normal"}),u.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en stock normal"}),e.jsx("div",{className:"max-h-96 overflow-y-auto hide-scrollbar space-y-4",children:u.map(s=>{const t=o(s.quantityStock);return e.jsxs("div",{className:"bg-white  rounded-2xl shadow-lg border border-green-200 p-6 hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-black-200 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-green-900 truncate",children:s.name}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full text-black  font-medium ${t.color}`,children:t.label})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Réf :"})," ",s.reference]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix d'achat :"})," ",e.jsxs("span",{className:"text-orange-600",children:[s.price_buy.toFixed(2)," MAD"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix de vente :"})," ",e.jsxs("span",{className:"text-green-600",children:[s.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix total :"})," ",e.jsxs("span",{className:"text-green-600",children:[(s.price_sell*s.quantityStock).toFixed(2)," MAD"]})]})]})]}),e.jsx("div",{className:"space-y-2 text-black m-2 border-t border-black-300",children:e.jsxs("p",{className:"text-m p-4 pb-0 flex items-center gap-2",children:[e.jsx(h,{className:"h-6 w-6 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"Quantité :"}),e.jsx("span",{className:"font-bold",children:s.quantityStock})]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-amber-700",children:"Stock Faible"}),b.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en stock faible"}),e.jsx("div",{className:"max-h-96 overflow-y-auto hide-scrollbar space-y-4",children:b.map(s=>{const t=o(s.quantityStock);return e.jsxs("div",{className:"bg-amber-50 hover:bg-white rounded-2xl shadow-lg border border-amber-200 p-6 hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-black-200 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-900 truncate",children:s.name}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full text-black font-medium ${t.color}`,children:t.label})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Réf :"})," ",s.reference]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix d'achat :"})," ",e.jsxs("span",{className:"text-orange-600",children:[s.price_buy.toFixed(2)," MAD"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix de vente :"})," ",e.jsxs("span",{className:"text-green-600",children:[s.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix total :"})," ",e.jsxs("span",{className:"text-green-600",children:[(s.price_sell*s.quantityStock).toFixed(2)," MAD"]})]})]})]}),e.jsx("div",{className:"space-y-2 text-black m-2 border-t border-black-300",children:e.jsxs("p",{className:"text-m p-4 pb-0 flex items-center gap-2",children:[e.jsx(h,{className:"h-6 w-6 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"Quantité :"}),e.jsx("span",{className:"font-bold",children:s.quantityStock})]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-red-700",children:"Stock Rupture"}),p.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en rupture de stock"}),e.jsx("div",{className:"max-h-96 overflow-y-auto hide-scrollbar space-y-4",children:p.map(s=>{const t=o(s.quantityStock);return e.jsxs("div",{className:"bg-red-50 hover:bg-white rounded-2xl shadow-lg border border-red-200 p-6 hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-black-300 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-red-900 truncate",children:s.name}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full text-black font-medium ${t.color}`,children:t.label})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Réf :"})," ",s.reference]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix d'achat :"})," ",e.jsxs("span",{className:"text-orange-600",children:[s.price_buy.toFixed(2)," MAD"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix de vente :"})," ",e.jsxs("span",{className:"text-green-600",children:[s.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Prix total :"})," ",e.jsxs("span",{className:"text-green-600",children:[(s.price_sell*s.quantityStock).toFixed(2)," MAD"]})]})]})]}),e.jsx("div",{className:"space-y-2 text-black m-2 border-t border-black-300",children:e.jsxs("p",{className:"text-m p-4 pb-0 flex items-center gap-2",children:[e.jsx(h,{className:"h-6 w-6 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"Quantité :"}),e.jsx("span",{className:"font-bold",children:s.quantityStock})]})})]},s.id)})})]})]}),e.jsx(T,{isOpen:f,onClose:handleCloseModal,title:"Réapprovisionner le stock",children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produit"}),e.jsxs("select",{required:!0,value:a.produitId,onChange:s=>c({...a,produitId:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez un produit"}),r.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Point de vente"}),e.jsxs("select",{required:!0,value:a.pointVenteId,onChange:s=>c({...a,pointVenteId:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez un point de vente"}),k.map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantité à ajouter"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",required:!0,value:a.quantite,onChange:s=>c({...a,quantite:parseFloat(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(x,{variant:"outline",onClick:handleCloseModal,children:"Annuler"}),e.jsx(x,{type:"submit",loading:reapprovisionnementMutation.isLoading,children:"Réapprovisionner"})]})]})})]})]})};export{W as default};
