import{r as x,j as s,D as P}from"./index-tLwmzl-Q.js";import{v as k}from"./venteApi-CPDvCpwX.js";import{B as y}from"./Button-Lskl0WlK.js";import{E as z}from"./jspdf.es.min-BfiA6Olc.js";import{R as L}from"./refresh-cw-CNRvxXwQ.js";const G=()=>{const[l,q]=x.useState([]),[i,u]=x.useState([]),[w,h]=x.useState(!0),p=(()=>{try{return JSON.parse(localStorage.getItem("user"))?.boutiqueId||null}catch{return null}})(),f=async()=>{if(!p){console.error("Boutique ID not found in localStorage user object."),h(!1);return}try{h(!0);const e=await k.getByPointVente(p);q(e.data)}catch(e){console.error("Erreur lors du chargement des ventes",e)}finally{h(!1)}};x.useEffect(()=>{f()},[]);const I=e=>{u(o=>o.includes(e)?o.filter(t=>t!==e):[...o,e])},T=()=>{const e=new z,o=l.filter(c=>i.includes(c.id));let t=10;const j=new Date,v=j.toLocaleDateString()+" "+j.toLocaleTimeString(),m=new Image;m.src="/img/logo.jpg",m.onload=()=>{e.addImage(m,"JPEG",10,t,40,25),t+=5,e.setFontSize(22),e.setFont("helvetica","bold"),e.text("FACTURE",85,t),t+=25;const c=o.length>0?o[0].boutique:null,$=c?.nom||"Boutique inconnue",A=c?.adresse?.trim()||"Adresse non disponible";e.setFontSize(10),e.setFont("helvetica","normal"),e.text(` ${v}`,190,t,{align:"right"}),e.text(`Boutique : ${$}`,190,t+6,{align:"right"}),e.text(`Adresse : ${A}`,190,t+12,{align:"right"}),t+=5;const d={name:"Future Fragrance",address:"123 Rue Médina, Marrakech, Maroc",phone:"+212 6 00 00 00 00",email:"contact@riadamine.ma"};e.setFontSize(18),e.setFont("helvetica","bold"),e.text(d.name,10,t),e.setFont("helvetica","normal"),e.setFontSize(12),e.text(d.address,10,t+6),e.text(`Tél: ${d.phone}`,10,t+12),e.text(`Email: ${d.email}`,10,t+18),t+=30,e.setFontSize(11),e.setFont("helvetica","bold"),e.setFillColor(0),e.setTextColor(255),e.rect(10,t,190,10,"F"),e.text("N°",12,t+6),e.text("Date Vente",22,t+6),e.text("Produit",60,t+6),e.text("Référence",100,t+6),e.text("Prix",125,t+6),e.text("Quantité",145,t+6),e.text("Total",165,t+6),t+=10,e.setFont("helvetica","normal"),e.setTextColor(0);const n={num:10,date:22,produit:60,ref:100,prix:125,qte:145,total:165,end:200},F=t,N=[];let S=0,E=0;o.forEach((r,B)=>{r.produits.forEach((g,M)=>{const D=g.price_sell||0,b=r.quantity||1,C=D*b;S+=b,E+=C,t>270&&(e.addPage(),t=20),N.push(t),t+=5,e.text(`${B+1}`,n.num+2,t),e.text(` ${new Date(r.dateVente).toLocaleDateString()}`,n.date,t),e.text(` ${g.name}`,n.produit,t),e.text(` ${g.reference}`,n.ref,t),e.text(` ${D.toFixed(2)}`,n.prix,t),e.text(` ${b}`,n.qte,t),e.text(` ${C.toFixed(2)}`,n.total,t),t+=4})}),e.setDrawColor(150),Object.values(n).forEach(r=>{e.line(r,F,r,t)}),e.line(200,F,200,t),N.forEach(r=>{e.line(10,r+0,200,r+0)}),e.line(10,t,200,t),e.setFillColor(0),e.rect(10,t,190,5,"F"),t+=15,e.setFont("helvetica","bold"),e.text("TOTAL GLOBAL",60,t),e.text(`${S}`,145,t),e.text(`${E.toFixed(2)} MAD`,165,t);let a=e.internal.pageSize.height-40;e.setFillColor(0),e.rect(10,a,190,5,"F"),a+=10,e.setFontSize(10),e.setTextColor(0),e.setFont("helvetica","normal"),e.text("Paiement à l’ordre de Future Fragrance",10,a),a+=5,e.text("N° de compte : 0123 4567 8901 2345",10,a),e.text("Conditions de paiement : sous 30 jours",130,a),a+=10,e.setFont("helvetica","italic"),e.text("MERCI DE VOTRE CONFIANCE",70,a),e.save("liste_ventes.pdf")}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Exporter les Factures"}),s.jsx("p",{className:"text-gray-600",children:"Sélectionnez des ventes à exporter en PDF"})]}),s.jsxs(y,{variant:"outline",onClick:f,children:[s.jsx(L,{className:"w-4 h-4 mr-2"}),"Actualiser"]})]}),w?s.jsx("p",{children:"Chargement..."}):l.length===0?s.jsx("p",{children:"Aucune vente disponible."}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex space-x-4",children:s.jsxs(y,{onClick:T,disabled:i.length===0,children:[s.jsx(P,{className:"w-4 h-4 mr-2"}),"Exporter Facture PDF"]})}),s.jsx("div",{className:"overflow-x-auto mt-6",children:s.jsxs("table",{className:"min-w-full border border-gray-200 text-sm text-left",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.length===l.length,onChange:e=>{e.target.checked?u(l.map(o=>o.id)):u([])}})}),s.jsx("th",{className:"p-3 border-b",children:"#"}),s.jsx("th",{className:"p-3 border-b",children:"Date"}),s.jsx("th",{className:"p-3 border-b",children:"Boutique"}),s.jsx("th",{className:"p-3 border-b",children:"Montant"})]})}),s.jsx("tbody",{children:l.map((e,o)=>s.jsxs("tr",{className:i.includes(e.id)?"bg-blue-50 border-t border-blue-200":"border-t",children:[s.jsx("td",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>I(e.id)})}),s.jsxs("td",{className:"p-3 border-b",children:["Vente #",e.id]}),s.jsx("td",{className:"p-3 border-b",children:new Date(e.dateVente).toLocaleString()}),s.jsx("td",{className:"p-3 border-b",children:e.boutique?.nom||"N/A"}),s.jsxs("td",{className:"p-3 border-b text-green-600 font-medium",children:[e.montantTotal?.toFixed(2)," MAD"]})]},e.id))})]})})]})]})};export{G as default};
