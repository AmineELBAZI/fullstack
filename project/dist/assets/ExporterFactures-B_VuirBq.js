import{r as d,j as s,D as A}from"./index-yrzGcrsz.js";import{v as q}from"./venteApi-BzG1DnF_.js";import{B as E}from"./Button-CeNaAo-j.js";import{R as k,E as z}from"./jspdf.es.min-DaNoBZeB.js";import"./axiosInstance-Cz6MWCIH.js";import"./LoadingSpinner-xF3CygPc.js";const H=()=>{const[l,S]=d.useState([]),[i,x]=d.useState([]),[D,p]=d.useState(!0),b=async()=>{try{p(!0);const e=await q.getAll();S(e.data)}catch(e){console.error("Erreur lors du chargement des ventes",e)}finally{p(!1)}};d.useEffect(()=>{b()},[]);const y=e=>{x(o=>o.includes(e)?o.filter(t=>t!==e):[...o,e])},T=()=>{const e=new z,o=l.filter(n=>i.includes(n.id));let t=10;const g=new Date,w=g.toLocaleDateString()+" "+g.toLocaleTimeString(),m=new Image;m.src="/img/logo.jpg",m.onload=()=>{e.addImage(m,"JPEG",10,t,40,25),t+=5,e.setFontSize(22),e.setFont("helvetica","bold"),e.text("FACTURE",85,t),t+=15,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(` ${w}`,190,t,{align:"right"}),t+=10;const n={name:"Future Fragrance",address:"123 Rue Médina, Marrakech, Maroc",phone:"+212 6 00 00 00 00",email:"contact@riadamine.ma"};e.setFontSize(18),e.setFont("helvetica","bold"),e.text(n.name,10,t),e.setFont("helvetica","normal"),e.setFontSize(12),e.text(n.address,10,t+6),e.text(`Tél: ${n.phone}`,10,t+12),e.text(`Email: ${n.email}`,10,t+18),t+=30;const F=()=>{e.setFontSize(11),e.setFont("helvetica","bold"),e.setFillColor(0),e.setTextColor(255),e.rect(10,t,190,10,"F"),e.text("N°",12,t+6),e.text("Date Vente",22,t+6),e.text("Boutique",45,t+6),e.text("Produit",75,t+6),e.text("Référence",108,t+6),e.text("Prix",135,t+6),e.text("Quantité",150,t+6),e.text("Total",180,t+6),t+=10,e.setFont("helvetica","normal"),e.setTextColor(0)},r={num:10,date:18,Boutique:45,produit:75,ref:108,prix:135,qte:150,total:172};F();let j=0,f=0;o.forEach((c,$)=>{const v=c.boutique?.nom||"N/A";c.produits.forEach((h,L)=>{const N=h.price_sell||0,u=c.quantity||1,C=N*u;j+=u,f+=C,t>270&&(e.line(10,t,200,t),e.addPage(),t=20,F()),t+=5,e.text(`${$+1}`,r.num+2,t),e.text(` ${new Date(c.dateVente).toLocaleDateString()}`,r.date,t),e.text(` ${v}`,r.Boutique,t),e.text(` ${h.name}`,r.produit,t),e.text(` ${h.reference}`,r.ref,t),e.text(` ${N.toFixed(2)}`,r.prix,t),e.text(` ${u}`,r.qte,t),e.text(` ${C.toFixed(2)}`,r.total,t),e.line(10,t+2,200,t+2),t+=4})}),e.line(10,t,200,t),e.setFillColor(0),e.rect(10,t,190,5,"F"),t+=15,e.setFont("helvetica","bold"),e.text("TOTAL GLOBAL",60,t),e.text(`${j}`,145,t),e.text(`${f.toFixed(2)} MAD`,165,t);let a=e.internal.pageSize.height-40;e.setFillColor(0),e.rect(10,a,190,5,"F"),a+=10,e.setFontSize(10),e.setTextColor(0),e.setFont("helvetica","normal"),e.text("Paiement à l’ordre de Future Fragrance",10,a),a+=5,e.text("N° de compte : 0123 4567 8901 2345",10,a),e.text("Conditions de paiement : sous 30 jours",130,a),a+=10,e.setFont("helvetica","italic"),e.text("MERCI DE VOTRE CONFIANCE",70,a),e.save("liste_ventes.pdf")}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Exporter les Factures"}),s.jsx("p",{className:"text-gray-600",children:"Sélectionnez des ventes à exporter en PDF"})]}),s.jsxs(E,{variant:"outline",onClick:b,children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"Actualiser"]})]}),D?s.jsx("p",{children:"Chargement..."}):l.length===0?s.jsx("p",{children:"Aucune vente disponible."}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex space-x-4",children:s.jsxs(E,{onClick:T,disabled:i.length===0,children:[s.jsx(A,{className:"w-4 h-4 mr-2"}),"Exporter Facture PDF"]})}),s.jsx("div",{className:"overflow-x-auto mt-6",children:s.jsxs("table",{className:"min-w-full border border-gray-200 text-sm text-left",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.length===l.length,onChange:e=>{e.target.checked?x(l.map(o=>o.id)):x([])}})}),s.jsx("th",{className:"p-3 border-b",children:"#"}),s.jsx("th",{className:"p-3 border-b",children:"Date"}),s.jsx("th",{className:"p-3 border-b",children:"Boutique"}),s.jsx("th",{className:"p-3 border-b",children:"Montant"})]})}),s.jsx("tbody",{children:l.map((e,o)=>s.jsxs("tr",{className:i.includes(e.id)?"bg-blue-50 border-t border-blue-200":"border-t",children:[s.jsx("td",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>y(e.id)})}),s.jsxs("td",{className:"p-3 border-b",children:["Vente #",e.id]}),s.jsx("td",{className:"p-3 border-b",children:new Date(e.dateVente).toLocaleString()}),s.jsx("td",{className:"p-3 border-b",children:e.boutique?.nom||"N/A"}),s.jsxs("td",{className:"p-3 border-b text-green-600 font-medium",children:[e.montantTotal?.toFixed(2)," MAD"]})]},e.id))})]})})]})]})};export{H as default};
