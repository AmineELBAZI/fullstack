import{r as n,j as s,D as I}from"./index-tLwmzl-Q.js";import{v as P}from"./venteApi-CPDvCpwX.js";import{B as C}from"./Button-Lskl0WlK.js";import{E as R}from"./jspdf.es.min-BfiA6Olc.js";import{R as L}from"./refresh-cw-CNRvxXwQ.js";const J=()=>{const[c,v]=n.useState([]),[i,d]=n.useState([]),[E,g]=n.useState(!0),[x,T]=n.useState("all"),[w,A]=n.useState([]),j=async()=>{try{g(!0);const e=await P.getAll();v(e.data);const o=Array.from(new Set(e.data.map(t=>t.boutique?.nom))).filter(Boolean);A(o)}catch(e){console.error("Erreur lors du chargement des ventes",e)}finally{g(!1)}};n.useEffect(()=>{j()},[]);const D=e=>{d(o=>o.includes(e)?o.filter(t=>t!==e):[...o,e])},u=x==="all"?c:c.filter(e=>e.boutique?.nom===x),B=()=>{const e=new R,o=c.filter(l=>i.includes(l.id));let t=10;const f=new Date,$=f.toLocaleDateString()+" "+f.toLocaleTimeString(),m=new Image;m.src="/img/logo.jpg",m.onload=()=>{e.addImage(m,"JPEG",10,t,40,25),t+=5,e.setFontSize(22),e.setFont("helvetica","bold"),e.text("FACTURE",85,t),t+=15,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(` ${$}`,190,t,{align:"right"}),t+=10;const l={name:"Future Fragrance",address:"123 Rue Médina, Marrakech, Maroc",phone:"+212 6 00 00 00 00",email:"contact@riadamine.ma"};e.setFontSize(18),e.setFont("helvetica","bold"),e.text(l.name,10,t),e.setFont("helvetica","normal"),e.setFontSize(12),e.text(l.address,10,t+6),e.text(`Tél: ${l.phone}`,10,t+12),e.text(`Email: ${l.email}`,10,t+18),t+=30;const F=()=>{e.setFontSize(11),e.setFont("helvetica","bold"),e.setFillColor(0),e.setTextColor(255),e.rect(10,t,190,10,"F"),e.text("N°",12,t+6),e.text("Boutique",45,t+6),e.text("Produit",75,t+6),e.text("Référence",108,t+6),e.text("Prix",135,t+6),e.text("Quantité",150,t+6),e.text("Total",180,t+6),t+=10,e.setFont("helvetica","normal"),e.setTextColor(0)},a={num:10,Boutique:45,produit:75,ref:108,prix:135,qte:150,total:172};F();let N=0,S=0;o.forEach((h,k)=>{const z=h.boutique?.nom||"N/A";h.produits.forEach((p,V)=>{const q=p.price_sell||0,b=h.quantity||1,y=q*b;N+=b,S+=y,t>270&&(e.line(10,t,200,t),e.addPage(),t=20,F()),t+=5,e.text(`${k+1}`,a.num+2,t),e.text(` ${z}`,a.Boutique,t),e.text(` ${p.name}`,a.produit,t),e.text(` ${p.reference}`,a.ref,t),e.text(` ${q.toFixed(2)}`,a.prix,t),e.text(` ${b}`,a.qte,t),e.text(` ${y.toFixed(2)}`,a.total,t),e.line(10,t+2,200,t+2),t+=4})}),e.line(10,t,200,t),e.setFillColor(0),e.rect(10,t,190,5,"F"),t+=15,e.setFont("helvetica","bold"),e.text("TOTAL GLOBAL",60,t),e.text(`${N}`,145,t),e.text(`${S.toFixed(2)} MAD`,165,t);let r=e.internal.pageSize.height-40;e.setFillColor(0),e.rect(10,r,190,5,"F"),r+=10,e.setFontSize(10),e.setTextColor(0),e.setFont("helvetica","normal"),e.text("Paiement à l’ordre de Future Fragrance",10,r),r+=5,e.text("N° de compte : 0123 4567 8901 2345",10,r),e.text("Conditions de paiement : sous 30 jours",130,r),r+=10,e.setFont("helvetica","italic"),e.text("MERCI DE VOTRE CONFIANCE",70,r),e.save("liste_ventes.pdf")}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Exporter les Factures"}),s.jsx("p",{className:"text-gray-600",children:"Sélectionnez des ventes à exporter en PDF"})]}),s.jsxs(C,{variant:"outline",onClick:j,children:[s.jsx(L,{className:"w-4 h-4 mr-2"}),"Actualiser"]})]}),E?s.jsx("p",{children:"Chargement..."}):c.length===0?s.jsx("p",{children:"Aucune vente disponible."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex space-x-4 items-center",children:[s.jsxs(C,{onClick:B,disabled:i.length===0,children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"Exporter Facture PDF"]}),s.jsxs("select",{className:"border border-gray-300 rounded px-3 py-1",value:x,onChange:e=>T(e.target.value),children:[s.jsx("option",{value:"all",children:"Toutes les boutiques"}),w.map((e,o)=>s.jsx("option",{value:e,children:e},o))]})]}),s.jsx("div",{className:"overflow-x-auto mt-6",children:s.jsxs("table",{className:"min-w-full border border-gray-200 text-sm text-left",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.length===u.length,onChange:e=>{e.target.checked?d(u.map(o=>o.id)):d([])}})}),s.jsx("th",{className:"p-3 border-b",children:"#"}),s.jsx("th",{className:"p-3 border-b",children:"Date"}),s.jsx("th",{className:"p-3 border-b",children:"Boutique"}),s.jsx("th",{className:"p-3 border-b",children:"Montant"})]})}),s.jsx("tbody",{children:u.map((e,o)=>s.jsxs("tr",{className:i.includes(e.id)?"bg-blue-50 border-t border-blue-200":"border-t",children:[s.jsx("td",{className:"p-3 border-b",children:s.jsx("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>D(e.id)})}),s.jsxs("td",{className:"p-3 border-b",children:["Vente #",e.id]}),s.jsx("td",{className:"p-3 border-b",children:new Date(e.dateVente).toLocaleString()}),s.jsx("td",{className:"p-3 border-b",children:e.boutique?.nom||"N/A"}),s.jsxs("td",{className:"p-3 border-b text-green-600 font-medium",children:[e.montantTotal?.toFixed(2)," MAD"]})]},e.id))})]})})]})]})};export{J as default};
