import{d as q,f as c,r as d,u as Q,j as e,L as T,U as k,P as G,V as n}from"./index-tLwmzl-Q.js";import{M as K}from"./Modal-D33wMkEt.js";import{B as N}from"./Button-Lskl0WlK.js";import{u as A}from"./useQuery-BLmLD0fm.js";import{u as w}from"./useMutation-DIgAZNyt.js";import{P as _,S as Z}from"./square-pen-bL-ZCu7X.js";import{S as H}from"./search-BLaTwSSR.js";import{T as J}from"./trash-2-Bnbpo4Sm.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=q("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=q("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ee="http://futurefragrance.store",m=`${ee}/api/users`,h={getAll:()=>c.get(m),getById:a=>c.get(`${m}/${a}`),create:a=>c.post(`${m}/create`,a),update:(a,f)=>c.put(`${m}/${a}`,f),delete:a=>c.delete(`${m}/${a}`)},ue=()=>{const[a,f]=d.useState(""),[I,E]=d.useState(!1),[i,g]=d.useState(null),[b,M]=d.useState(!1),[x,u]=d.useState({}),[l,o]=d.useState({username:"",password:"",role:"VENDEUR",boutique:null,active:!0}),j=Q(),{data:L=[],isLoading:$}=A({queryKey:["utilisateurs"],queryFn:()=>h.getAll().then(s=>s.data)}),{data:S=[]}=A({queryKey:["points-vente"],queryFn:()=>G.getAllPointsVente().then(s=>s.data)}),U=w(h.create,{onSuccess:()=>{j.invalidateQueries(["utilisateurs"]),n.success("Utilisateur créé avec succès"),p(),u({})},onError:s=>{const t=s?.response?.data?.message||"Erreur lors de la création de l'utilisateur";t.includes("Username")?u({username:t}):n.error(t)}}),C=w(({id:s,...t})=>h.update(s,t),{onSuccess:()=>{j.invalidateQueries(["utilisateurs"]),n.success("Utilisateur modifié avec succès"),p(),u({})},onError:s=>{const t=s?.response?.data?.message||"Erreur lors de la modification de l'utilisateur";n.error(t)}}),P=w(h.delete,{onSuccess:()=>{j.invalidateQueries(["utilisateurs"]),n.success("Utilisateur supprimé avec succès")},onError:()=>{n.error("Erreur lors de la suppression de l'utilisateur")}}),y=L.filter(s=>s.username.toLowerCase().includes(a.toLowerCase())),D=(s=null)=>{u({}),s?(g(s),o({username:s.username,password:"",role:s.role,boutique:s.boutique||null,active:!0})):(g(null),o({username:"",password:"",role:"VENDEUR",boutique:null,active:!0})),E(!0)},p=()=>{E(!1),g(null),M(!1),u({}),o({username:"",password:"",role:"VENDEUR",boutique:null,active:!0})},z=s=>{s.preventDefault();const t={...l};if(i&&!t.password&&delete t.password,t.role==="VENDEUR"){if(!t.boutique||!t.boutique.id){n.error("Le vendeur doit être associé à une boutique.");return}t.boutique={id:t.boutique.id}}else t.boutique=null;i?C.mutate({id:i.id,...t}):U.mutate(t)},F=s=>{window.confirm("Voulez-vous vraiment supprimer cet utilisateur ?")&&P.mutate(s)},B=s=>s==="ADMIN"?Y:k,V=s=>s==="ADMIN"?"text-blue-600 bg-blue-50":"text-green-600 bg-green-50";return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des utilisateurs"}),e.jsx("p",{className:"text-gray-600",children:"Gérez les comptes administrateurs et vendeurs"})]}),e.jsxs(N,{onClick:()=>D(),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Nouvel utilisateur"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:a,onChange:s=>f(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(()=>{const s=y.filter(r=>r.role==="ADMIN"),t=y.filter(r=>r.role==="VENDEUR");return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[...s,...t].map(r=>{const v=B(r.role),R=S.find(O=>r.boutique&&O.id===r.boutique.id);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border-2 p-6 transition-all border-gray-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${V(r.role)}`,children:e.jsx(v,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:r.username})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>D(r),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Modifier",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>F(r.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Rôle:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize ${V(r.role)}`,children:r.role==="ADMIN"?"Administrateur":"Vendeur"})]}),r.role==="VENDEUR"&&R&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Boutique:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:R.nom})]})]})]},r.id)})})})(),y.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur trouvé"})]}),e.jsx(K,{isOpen:I,onClose:p,title:i?"Modifier l'utilisateur":"Nouvel utilisateur",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom d'utilisateur"}),e.jsx("input",{id:"username",type:"text",required:!0,value:l.username,onChange:s=>{o({...l,username:s.target.value}),u({...x,username:null})},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.username?"border-red-500":"border-gray-300"}`,placeholder:"Ex: jean.dupont"}),x.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.username})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:i?"Nouveau mot de passe (laisser vide pour ne pas changer)":"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:b?"text":"password",required:!i,value:l.password,onChange:s=>o({...l,password:s.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>M(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:b?e.jsx(W,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:"Rôle"}),e.jsxs("select",{id:"role",value:l.role,onChange:s=>{const t=s.target.value;o(r=>({...r,role:t,boutique:t==="VENDEUR"?r.boutique:null}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"VENDEUR",children:"Vendeur"}),e.jsx("option",{value:"ADMIN",children:"Administrateur"})]})]}),l.role==="VENDEUR"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"boutique",className:"block text-sm font-medium text-gray-700 mb-2",children:"Boutique assignée"}),e.jsxs("select",{id:"boutique",required:!0,value:l.boutique?.id||"",onChange:s=>{const t=s.target.value,r=t?{id:parseInt(t,10)}:null;o(v=>({...v,boutique:r}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez une boutique"}),S.map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(N,{variant:"outline",onClick:p,children:"Annuler"}),e.jsx(N,{type:"submit",loading:U.isLoading||C.isLoading,children:i?"Modifier":"Créer"})]})]})})]})};export{ue as default};
