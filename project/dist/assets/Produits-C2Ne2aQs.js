import{r as o,u as Q,j as e,L as D,V as n}from"./index-tLwmzl-Q.js";import{p as x}from"./produitApi-rf_H1KRd.js";import{c as T}from"./CategorieApi-BuXoDlXi.js";import{M as O}from"./Modal-D33wMkEt.js";import{B as f}from"./Button-Lskl0WlK.js";import{u as R}from"./useQuery-BLmLD0fm.js";import{u as y}from"./useMutation-DIgAZNyt.js";import{S as z}from"./search-BLaTwSSR.js";import{P as B,S as I}from"./square-pen-bL-ZCu7X.js";import{T as V}from"./trash-2-Bnbpo4Sm.js";const ee=()=>{const[p,S]=o.useState(""),[C,j]=o.useState(!1),[c,g]=o.useState(null),[t,a]=o.useState({name:"",price_buy:0,price_sell:0,quantityStock:0,categorie:null,reference:""}),h=Q(),{data:d=[],isLoading:k,error:_}=R({queryKey:["categories"],queryFn:()=>T.getAll().then(r=>r.data)}),[v,q]=o.useState({}),[M,N]=o.useState(!0);o.useEffect(()=>{if(d.length===0)return;(async()=>{N(!0);try{const i={};for(const l of d){const s=await x.getByCategorie(l.id);i[l.nom]=s.data}q(i)}catch{n.error("Erreur lors du chargement des produits")}finally{N(!1)}})()},[d]);const w=y({mutationFn:x.create,onSuccess:()=>{h.invalidateQueries(["categories"]),n.success("Produit créé avec succès"),u()},onError:()=>n.error("Erreur lors de la création du produit")}),P=y({mutationFn:({id:r,...i})=>x.update(r,i),onSuccess:()=>{h.invalidateQueries(["categories"]),n.success("Produit modifié avec succès"),u()},onError:()=>n.error("Erreur lors de la modification du produit")}),E=y({mutationFn:x.delete,onSuccess:()=>{h.invalidateQueries(["categories"]),n.success("Produit supprimé avec succès")},onError:()=>n.error("Erreur lors de la suppression du produit")}),b=(r=null)=>{r?(g(r),a({name:r.name,reference:r.reference||"",price_buy:r.price_buy||0,price_sell:r.price_sell||0,quantityStock:r.quantityStock||0,categorie:r.categorie?.id||null})):(g(null),a({name:"",reference:"",price_buy:0,price_sell:0,quantityStock:0,categorie:""})),j(!0)},u=()=>{j(!1),g(null),a({name:"",reference:"",price_buy:0,price_sell:0,quantityStock:0,categorie:""})},L=r=>{r.preventDefault();const i=t.quantityStock||1,l=t.price_buy/i,s=t.price_sell/i,m={...t,price_buy:l,price_sell:s,categorie:{id:t.categorie},reference:t.reference?.trim()===""?null:t.reference.trim()};c?P.mutate({id:c.id,...m}):w.mutate(m)},A=r=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")&&E.mutate(r)};if(k||M)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(D,{size:"lg"})});if(_)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-red-600",children:"Erreur lors du chargement des catégories"})});const F=d.length>0?Object.values(v).every(r=>r.length===0):!0;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .hide-scrollbar::-webkit-scrollbar { display: none; }
          .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        `}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Produits"}),e.jsx("p",{className:"text-gray-600",children:"Liste des produits par catégorie"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:max-w-sm",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:p,onChange:r=>S(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs(f,{onClick:()=>b(),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Nouveau produit"]})]}),d.length===0?e.jsx("p",{className:"text-center text-gray-500 py-6",children:"Aucune catégorie trouvée."}):F?e.jsx("p",{className:"text-center text-gray-500 py-6",children:"Aucun produit disponible."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(v).map(([r,i])=>{const l=i.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())||s.reference?.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-blue-700 p-4 rounded-t-md border-b-4 border-blue-500 cursor-pointer",title:r,children:r}),l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit trouvé"}):e.jsx("div",{className:"max-h-96 overflow-y-auto pr-1 hide-scrollbar",children:l.map(s=>e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-4 last:mb-0 last:pb-0 last:border-none p-2 cursor-none min-h-[120px] flex flex-col justify-between hover:shadow-lg transition",onClick:()=>b(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Réf: ",s.reference]})]}),e.jsxs("div",{className:"flex space-x-2",onClick:m=>m.stopPropagation(),children:[e.jsx("button",{onClick:()=>b(s),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors","aria-label":"Modifier produit",title:"Modifier",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>A(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Supprimer produit",title:"Supprimer",children:e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Prix d'achat (1 g/ml) : ",e.jsxs("span",{className:"text-orange-600 font-semibold",children:[s.price_buy," MAD"]}),e.jsx("br",{}),"Prix de vente (1 g/ml) : ",e.jsxs("span",{className:"text-green-600 font-semibold",children:[s.price_sell," MAD"]}),e.jsx("br",{}),"Quantité de stock : ",e.jsx("span",{className:"text-blue-600 font-semibold",children:s.quantityStock})]})]},s.id))})]},r)})}),e.jsx(O,{isOpen:C,onClose:u,title:c?"Modifier le produit":"Nouveau produit",children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Référence (optionnelle)"}),e.jsx("input",{type:"text",placeholder:"Laissez vide pour générer automatiquement",value:t.reference,onChange:r=>a({...t,reference:r.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-lg ${c?"bg-gray-100 text-gray-600 cursor-not-allowed":""}`,disabled:!!c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:r=>a({...t,name:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prix d'achat "}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:t.price_buy,onChange:r=>a({...t,price_buy:parseFloat(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prix de vente "}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:t.price_sell,onChange:r=>a({...t,price_sell:parseFloat(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantité en stock"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"1",value:t.quantityStock,onChange:r=>a({...t,quantityStock:parseInt(r.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catégorie"}),e.jsxs("select",{required:!0,value:t.categorie||"",onChange:r=>a({...t,categorie:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Sélectionnez une catégorie --"}),d.map(r=>e.jsx("option",{value:r.id,children:r.nom},r.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(f,{variant:"outline",onClick:u,children:"Annuler"}),e.jsx(f,{type:"submit",loading:w.isLoading||P.isLoading,children:c?"Modifier":"Créer"})]})]})})]})]})};export{ee as default};
