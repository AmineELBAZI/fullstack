import{u as M,r as u,j as e,V as t}from"./index-tLwmzl-Q.js";import{c as n}from"./CategorieApi-BuXoDlXi.js";import{M as S}from"./Modal-D33wMkEt.js";import{B as m}from"./Button-Lskl0WlK.js";import{u as E}from"./useQuery-BLmLD0fm.js";import{u as x}from"./useMutation-DIgAZNyt.js";import{P,S as k}from"./square-pen-bL-ZCu7X.js";import{T as q}from"./trash-2-Bnbpo4Sm.js";const V=({onSelectCategorie:j})=>{const l=M(),{data:b=[],isLoading:N,error:v}=E({queryKey:["categories"],queryFn:()=>n.getAll().then(r=>r.data)}),h=x({mutationFn:n.create,onSuccess:()=>{l.invalidateQueries(["categories"]),t.success("Catégorie créée"),i()},onError:()=>t.error("Erreur création catégorie")}),p=x({mutationFn:({id:r,...s})=>n.update(r,s),onSuccess:()=>{l.invalidateQueries(["categories"]),t.success("Catégorie mise à jour"),i()},onError:()=>t.error("Erreur mise à jour catégorie")}),C=x({mutationFn:n.delete,onSuccess:()=>{l.invalidateQueries(["categories"]),t.success("Catégorie supprimée")},onError:()=>t.error("Erreur lors de la suppression de la catégorie : Pour supprimer une catégorie, celle-ci ne doit être liée à aucun produit.")}),[y,g]=u.useState(!1),[o,d]=u.useState(null),[c,a]=u.useState({nom:""}),f=(r=null)=>{r?(d(r),a({nom:r.nom})):(d(null),a({nom:""})),g(!0)},i=()=>{g(!1),d(null),a({nom:""})},w=r=>{r.preventDefault(),o?p.mutate({id:o.id,...c}):h.mutate(c)};return N?e.jsx("p",{children:"Chargement..."}):v?e.jsx("p",{children:"Erreur chargement catégories"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold ",children:"Catégories"}),e.jsxs(m,{onClick:()=>f(),children:[e.jsx(P,{className:"h-4 w-4 mr-2"})," Nouvelle catégorie"]})]}),e.jsx("div",{className:"bg-gradient-to-br from-white to-gray-100 rounded-xl shadow-xl p-6 border border-gray-200",children:e.jsxs("table",{className:"w-full table-auto rounded overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-blue-700 ",children:[e.jsx("th",{className:"p-3",children:"Nom"}),e.jsx("th",{className:"p-3",children:"Nombre de Produits"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{className:"hover:bg-indigo-50 transition cursor-pointer border-b",onClick:()=>j(r.id),children:[e.jsx("td",{className:"p-3 text-gray-800 font-medium",children:r.nom}),e.jsx("td",{className:"p-3 text-gray-600",children:r.produits?r.produits.length:0}),e.jsx("td",{className:"p-3 text-right",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"inline-flex space-x-2",children:[e.jsx("a",{onClick:s=>{s.stopPropagation(),f(r),className="bg-blue-500 hover:bg-blue-600 text-white border border-blue-700 hover:border-blue-900 transition-all duration-200"},children:e.jsx(k,{className:" p-1  text-gray-400 hover:text-blue-600 hover:bg-blue-200 rounded-lg transition-colors"})}),e.jsx("a",{onClick:s=>{s.stopPropagation(),window.confirm(`Supprimer la catégorie "${r.nom}" ?`)&&C.mutate(r.id)},className:"     transition-all duration-200",children:e.jsx(q,{className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-200 rounded-lg transition-colors"})})]})})]},r.id))})]})}),e.jsx(S,{isOpen:y,onClose:i,title:o?"Modifier Catégorie":"Nouvelle Catégorie",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Nom"}),e.jsx("input",{type:"text",required:!0,value:c.nom,onChange:r=>a({nom:r.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:i,children:"Annuler"}),e.jsx(m,{type:"submit",loading:h.isLoading||p.isLoading,children:o?"Modifier":"Créer"})]})]})})]})};export{V as default};
