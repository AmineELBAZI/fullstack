import{d as X,u as Y,r as n,j as e,L as ee,e as se,P as u,V as r}from"./index-tLwmzl-Q.js";import{p as te}from"./produitApi-rf_H1KRd.js";import{M as B}from"./Modal-D33wMkEt.js";import{B as c}from"./Button-Lskl0WlK.js";import{u as re}from"./useQuery-BLmLD0fm.js";import{u as m}from"./useMutation-DIgAZNyt.js";import{P as ne,S as ie}from"./square-pen-bL-ZCu7X.js";import{T as L}from"./trash-2-Bnbpo4Sm.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=X("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),p=(i,N="Une erreur est survenue")=>i?.response?.data?.message||i?.response?.data?.error||i?.message||N,he=()=>{const i=Y(),[N,x]=n.useState(!1),[h,b]=n.useState(null),[l,f]=n.useState({nom:"",adresse:""}),[d,o]=n.useState({nom:"",adresse:""}),[P,M]=n.useState(null),[D,S]=n.useState(!1),[E,I]=n.useState([]),[C,j]=n.useState(null),[g,v]=n.useState(null),[y,w]=n.useState(1),[Q,T]=n.useState(""),{data:F=[],isLoading:z,error:R}=re({queryKey:["pointsVente"],queryFn:()=>u.getAllPointsVente().then(s=>s.data)}),O=m({mutationFn:u.createPointVente,onSuccess:()=>{i.invalidateQueries(["pointsVente"]),r.success("Point de vente créé"),x(!1),o({})},onError:s=>{const t=p(s,"Erreur lors de la création");t.toLowerCase().includes("nom")?o({nom:t}):t.toLowerCase().includes("adresse")?o({adresse:t}):r.error(t)}}),_=m({mutationFn:({id:s,data:t})=>u.updatePointVente(s,t),onSuccess:()=>{i.invalidateQueries(["pointsVente"]),r.success("Point de vente modifié"),x(!1),o({})},onError:s=>{const t=p(s,"Erreur lors de la modification");t.toLowerCase().includes("nom")?o({nom:t}):t.toLowerCase().includes("adresse")?o({adresse:t}):r.error(t)}}),$=m({mutationFn:u.deletePointVente,onSuccess:()=>{i.invalidateQueries(["pointsVente"]),r.success("Point de vente supprimé"),M(null)},onError:s=>{r.error(p(s,"Erreur suppression"))}}),G=m({mutationFn:({boutiqueId:s,produitId:t,quantity:a})=>u.ajouterProduit(s,{produitId:t,quantity:a}),onSuccess:()=>{i.invalidateQueries(["pointsVente"]),r.success("Produit ajouté"),S(!1)},onError:s=>{r.error(p(s,"Erreur lors de l'ajout du produit."))}}),K=m({mutationFn:({boutiqueId:s,produitId:t})=>u.supprimerProduit(s,t),onSuccess:()=>{i.invalidateQueries(["pointsVente"]),r.success("Produit supprimé")},onError:s=>{r.error(p(s,"Erreur suppression produit"))}}),q=(s=null)=>{o({}),s?(b(s),f({nom:s.nom,adresse:s.adresse})):(b(null),f({nom:"",adresse:""})),x(!0)},A=()=>{x(!1),b(null),o({})},U=s=>{M(s),j(null),v(null),w(1),S(!0),te.getEnRupture().then(t=>I(t.data)).catch(()=>r.error("Erreur chargement produits disponibles"))},V=()=>{S(!1),j(null),v(null),w(1)},Z=s=>{s.preventDefault(),h?_.mutate({id:h.id,data:l}):O.mutate(l)},H=s=>{if(s.preventDefault(),!P||!C||!g){r.error("Veuillez sélectionner un produit.");return}if(y<=0){r.error("Veuillez saisir une quantité valide.");return}if(y>g.quantityStock){r.error("Quantité demandée supérieure au stock disponible.");return}G.mutate({boutiqueId:P,produitId:C,quantity:y})},J=s=>{const t=localStorage.getItem("password");if(!t){r.error("Aucun mot de passe enregistré.");return}const a=window.prompt("Pour confirmer la suppression, veuillez entrer votre mot de passe administrateur :");if(!a){r.error("Suppression annulée.");return}if(a!==t){r.error("Mot de passe incorrect.");return}window.confirm(`Supprimer ce point de vente ?

Les quantités de stock associées seront réintégrées au stock général des produits.`)&&$.mutate(s)},W=(s,t)=>{window.confirm("Supprimer ce produit ?")&&K.mutate({boutiqueId:s,produitId:t})};return z?e.jsx(ee,{size:"lg"}):R?e.jsx("div",{className:"text-red-500 text-center py-6",children:"Erreur chargement"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Points de vente"}),e.jsx("p",{className:"text-gray-500",children:"Gérez vos points de vente"})]}),e.jsxs(c,{onClick:()=>q(),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," Ajouter un point de vente"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:F.map(s=>e.jsxs("div",{className:"bg-gradient-to-br from-white via-sky-50 to-slate-100 border border-gray-200 rounded-2xl shadow-xl p-5 transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-6 h-6 text-sky-700"}),e.jsx("h2",{className:"text-lg font-semibold text-sky-800",children:s.nom})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4 mr-1 text-emerald-600"}),s.adresse]}),e.jsxs("span",{className:"inline-block text-xs bg-orange-100 text-orange-700 font-medium px-2 py-0.5 rounded-full",children:[s.stocks?.length??0," produit",(s.stocks?.length??0)>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>q(s),title:"Modifier",children:e.jsx(ie,{className:"w-5 h-5 text-blue-500 hover:text-blue-700 transition"})}),e.jsx("button",{onClick:()=>J(s.id),title:"Supprimer",children:e.jsx(L,{className:"w-5 h-5 text-red-500 hover:text-red-700 transition"})})]})]}),e.jsxs("div",{className:"mt-4 bg-white rounded-xl shadow-inner p-4",children:[e.jsx(c,{className:"mt-3",size:"sm",onClick:()=>U(s.id),children:"Ajouter un produit"}),e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Produits"}),!s.stocks||s.stocks.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"Aucun produit"}):e.jsx("div",{className:"max-h-56 overflow-y-auto hide-scrollbar space-y-2",children:e.jsx("ul",{children:s.stocks.map(t=>t.produit&&e.jsxs("li",{className:"flex justify-between items-start bg-gray-50 border border-orange-200 p-3 rounded-xl shadow-sm mb-1 ",children:[e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.produit.name}),e.jsxs("div",{className:"text-sm",children:["État :"," ",e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-semibold rounded-full
                                ${t.status==="VALIDATED"?"bg-green-100 text-green-700":t.status==="NOT_VALIDATED"?"bg-red-100 text-red-700":"bg-red-300 text-red-700"}`,children:t.status==="VALIDATED"?"Validé":t.status==="NOT_VALIDATED"?"Non validé":t.status})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Réf: ",t.produit.reference]}),e.jsxs("div",{className:"text-sm text-green-600",children:[t.produit.price_sell," MAD"]}),e.jsxs("div",{className:"text-sm",children:["Qté en boutique: ",t.quantity]})]}),e.jsx("button",{onClick:()=>W(s.id,t.produit.id),title:"Supprimer produit",children:e.jsx(L,{className:"w-4 h-4 text-red-500 hover:text-red-700"})})]},t.id))})})]})]},s.id))}),e.jsx(B,{isOpen:N,onClose:A,title:h?"Modifier":"Créer",children:e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nom"}),e.jsx("input",{required:!0,value:l.nom,onChange:s=>f({...l,nom:s.target.value}),className:`w-full border px-3 py-2 rounded ${d.nom?"border-red-500":""}`}),d.nom&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.nom})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Adresse"}),e.jsx("textarea",{required:!0,value:l.adresse,onChange:s=>f({...l,adresse:s.target.value}),className:`w-full border px-3 py-2 rounded ${d.adresse?"border-red-500":""}`}),d.adresse&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.adresse})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:A,children:"Annuler"}),e.jsx(c,{type:"submit",children:h?"Modifier":"Créer"})]})]})}),e.jsx(B,{isOpen:D,onClose:V,title:"Ajouter un produit",children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Sélectionnez un produit"}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:Q,onChange:s=>{const t=s.target.value;T(t);const a=E.find(k=>k.name.toLowerCase()===t.toLowerCase());a?(v(a),j(a.id)):(v(null),j(null))},className:"w-full border px-3 py-2 rounded",list:"produits-list",required:!0}),e.jsx("datalist",{id:"produits-list",children:E.map(s=>e.jsxs("option",{value:s.name,children:[s.name," - Réf: ",s.reference," - ",s.price_sell," MAD - Stock: ",s.quantityStock]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Quantité"}),e.jsx("input",{type:"number",min:"1",value:y,onChange:s=>w(Number(s.target.value)),required:!0,className:"w-full border px-3 py-2 rounded"}),g&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Stock disponible : ",g.quantityStock]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:V,children:"Annuler"}),e.jsx(c,{type:"submit",children:"Ajouter"})]})]})}),e.jsx("style",{children:`
          .hide-scrollbar::-webkit-scrollbar { display: none; }
          .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        `})]})};export{he as default};
