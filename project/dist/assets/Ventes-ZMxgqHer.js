import{c as w,r as n,j as e,S as i}from"./index-yrzGcrsz.js";import{v as q}from"./venteApi-BzG1DnF_.js";import{P as M}from"./PointsVenteApi-D-qlhskv.js";import{L as V}from"./LoadingSpinner-xF3CygPc.js";import{u as c}from"./useQuery-CZB9O9Qr.js";import{D as A}from"./dollar-sign-DKeqBhxJ.js";import"./axiosInstance-Cz6MWCIH.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=w("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),I=()=>{const[r,o]=n.useState(""),[d,x]=n.useState(""),[l,m]=n.useState(""),{data:h,isLoading:p,isError:u}=c({queryKey:["ventes"],queryFn:()=>q.getAll().then(t=>t.data)}),{data:g=[],isLoading:j}=c({queryKey:["points-vente"],queryFn:()=>M.getAllPointsVente().then(t=>t.data)}),a=(h||[]).filter(t=>{const s=new Date(t.dateVente),f=d?s>=new Date(d):!0,v=l?s<=new Date(l):!0,D=r?t.boutique?.id===parseInt(r):!0;return f&&v&&D}).sort((t,s)=>new Date(s.dateVente)-new Date(t.dateVente)),y=a.length,N=a.reduce((t,s)=>t+(s.quantity||0),0),b=a.reduce((t,s)=>t+(s.montantTotal||0),0);return p||j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(V,{size:"lg"})}):u?e.jsx("div",{className:"text-center text-red-600 mt-8",children:"Une erreur est survenue lors du chargement des ventes."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Liste des ventes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(i,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nombre de ventes"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:y})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(F,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantité totale vendue"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:N})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-yellow-100 p-3 rounded-lg",children:e.jsx(A,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Chiffre d'affaires"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[b.toFixed(2)," MAD"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Point de vente"}),e.jsxs("select",{value:r,onChange:t=>o(t.target.value),className:"border border-gray-300 rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Tous les points de vente"}),g.map(t=>e.jsx("option",{value:t.id,children:t.nom},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de début"}),e.jsx("input",{type:"date",value:d,onChange:t=>x(t.target.value),className:"border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de fin"}),e.jsx("input",{type:"date",value:l,onChange:t=>m(t.target.value),className:"border border-gray-300 rounded px-3 py-2"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Historique des ventes"})}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Point de vente"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Quantité"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Prix unitaire"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Date"})]})}),e.jsx("tbody",{children:a.map(t=>t.produits.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:s.name}),e.jsx("td",{className:"px-6 py-4",children:t.boutique?.nom||"—"}),e.jsx("td",{className:"px-6 py-4",children:t.produits.length===1?t.quantity:(t.quantity/t.produits.length).toFixed(2)}),e.jsxs("td",{className:"px-6 py-4",children:[(t.montantTotal/t.quantity).toFixed(2)," MAD"]}),e.jsxs("td",{className:"px-6 py-4 text-green-600 font-semibold",children:[(t.montantTotal/t.produits.length).toFixed(2)," MAD"]}),e.jsx("td",{className:"px-6 py-4",children:new Date(t.dateVente).toLocaleDateString("fr-FR")})]},`${t.id}-${s.id}`)))})]})}),e.jsx("div",{className:"md:hidden px-4 py-6 space-y-4",children:a.map(t=>t.produits.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg shadow-sm p-4 space-y-1 border",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Point de vente:"})," ",t.boutique?.nom||"—"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Quantité:"})," ",t.produits.length===1?t.quantity:(t.quantity/t.produits.length).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Prix unitaire:"})," ",(t.montantTotal/t.quantity).toFixed(2)," MAD"]}),e.jsxs("p",{className:"text-sm text-green-600 font-semibold",children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",(t.montantTotal/t.produits.length).toFixed(2)," MAD"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(t.dateVente).toLocaleDateString("fr-FR")]})]},`${t.id}-${s.id}`)))}),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(i,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Aucune vente trouvée"})]})]})]})};export{I as default};
