import{c as k,e as Q,r as m,u as U,j as e,P as _}from"./index-yrzGcrsz.js";import{P as E}from"./PointsVenteApi-D-qlhskv.js";import{p as J}from"./produitApi-qwVbZCBa.js";import{c as z}from"./CategorieApi-NIYRnbMd.js";import{P as Z,M as B}from"./Modal-CRmXHlMq.js";import{B as h}from"./Button-CeNaAo-j.js";import{L as O}from"./LoadingSpinner-xF3CygPc.js";import{V as g}from"./index-CyOt5fqF.js";import{u as b}from"./useQuery-CZB9O9Qr.js";import{u as $}from"./useMutation-DpsCt41A.js";import"./axiosInstance-Cz6MWCIH.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=k("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=k("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),H="http://localhost:3001/api",W=Q.create({baseURL:H,headers:{"Content-Type":"application/json"}});W.interceptors.request.use(s=>{const i=localStorage.getItem("token");return i&&(s.headers.Authorization=`Bearer ${i}`),s});const j=[{id:1,produitId:1,pointVenteId:1,quantite:50.5,derniereMiseAJour:"2024-01-20T14:30:00Z",produit:{nom:"Huile d'olive Extra Vierge",unite:"L",type:"huile",prixUnitaire:85},pointVente:{nom:"Magasin Centre-Ville"}},{id:2,produitId:2,pointVenteId:1,quantite:2500,derniereMiseAJour:"2024-01-19T16:45:00Z",produit:{nom:"Whisky Premium",unite:"mL",type:"alcool",prixUnitaire:.12},pointVente:{nom:"Magasin Centre-Ville"}},{id:3,produitId:1,pointVenteId:2,quantite:3.8,derniereMiseAJour:"2024-01-21T09:15:00Z",produit:{nom:"Huile d'olive Extra Vierge",unite:"L",type:"huile",prixUnitaire:85},pointVente:{nom:"Succursale Maarif"}},{id:4,produitId:3,pointVenteId:1,quantite:0,derniereMiseAJour:"2024-01-18T11:20:00Z",produit:{nom:"Farine de blé",unite:"g",type:"cereale",prixUnitaire:.008},pointVente:{nom:"Magasin Centre-Ville"}},{id:5,produitId:2,pointVenteId:2,quantite:8,derniereMiseAJour:"2024-01-20T08:30:00Z",produit:{nom:"Whisky Premium",unite:"mL",type:"alcool",prixUnitaire:.12},pointVente:{nom:"Succursale Maarif"}}],X={reapprovisionner:async({produitId:s,pointVenteId:i,quantite:a})=>new Promise(u=>{setTimeout(()=>{const d=j.find(l=>l.produitId===parseInt(s)&&l.pointVenteId===parseInt(i));if(d)d.quantite+=parseFloat(a),d.derniereMiseAJour=new Date().toISOString();else{const l={id:Math.max(...j.map(r=>r.id))+1,produitId:parseInt(s),pointVenteId:parseInt(i),quantite:parseFloat(a),derniereMiseAJour:new Date().toISOString(),produit:{nom:"Produit",unite:"unité",type:"type",prixUnitaire:0},pointVente:{nom:"Point de vente"}};j.push(l)}u({data:d||{success:!0}})},600)})},ce=()=>{const[s,i]=m.useState(0),[a,u]=m.useState(10),[d,l]=m.useState(!1),[r,c]=m.useState({produitId:"",pointVenteId:"",quantite:0}),S=U(),{data:o=[],isLoading:q}=b({queryKey:["allProduits"],queryFn:()=>J.getAll().then(t=>t.data),staleTime:300*1e3}),{data:I=[],isLoading:w}=b({queryKey:["pointsVente"],queryFn:()=>E.getAllPointsVente().then(t=>t.data)}),{data:A=[],isLoading:M}=b({queryKey:["categories"],queryFn:()=>z.getAll().then(t=>t.data)}),y=$({mutationFn:X.reapprovisionner,onSuccess:()=>{S.invalidateQueries(["allProduits"]),g.success("Réapprovisionnement effectué avec succès"),x()},onError:()=>{g.error("Erreur lors du réapprovisionnement")}}),V=()=>{c({produitId:"",pointVenteId:"",quantite:0}),l(!0)},x=()=>{l(!1),c({produitId:"",pointVenteId:"",quantite:0})},P=t=>{if(t.preventDefault(),!r.produitId||!r.pointVenteId||r.quantite<=0){g.error("Veuillez remplir tous les champs correctement");return}y.mutate(r)},p=t=>t<=s?{color:"text-red-600 bg-red-100",label:"Rupture"}:t>s&&t<=a?{color:"text-amber-600 bg-amber-100",label:"Faible"}:{color:"text-green-600 bg-green-100",label:"Normal"},C=o.filter(t=>t.quantityStock<=s).length,F=o.filter(t=>t.quantityStock>s&&t.quantityStock<=a).length,L=o.length,R=A.map(t=>{const n=(t.produits||[]).reduce((D,T)=>D+(T.quantityStock||0),0);return{id:t.id,nom:t.nom,quantite:n}}),f=o.filter(t=>t.quantityStock>a),N=o.filter(t=>t.quantityStock>s&&t.quantityStock<=a),v=o.filter(t=>t.quantityStock<=s);return q||w||M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des produits"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des produits"}),e.jsx("p",{className:"text-gray-600",children:"Liste et statistiques des produits"})]}),e.jsxs(h,{onClick:V,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Réapprovisionner"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(_,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Produits"}),e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:L})]})]}),e.jsxs("div",{className:"bg-amber-100 shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-amber-200 p-3 rounded-lg",children:e.jsx(K,{className:"h-6 w-6 text-amber-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700 text-sm",children:"Stock faible"}),e.jsx("p",{className:"text-xl font-semibold text-amber-800",children:F})]})]}),e.jsxs("div",{className:"bg-red-50 shadow rounded-xl p-5 border border-gray-100 flex items-center space-x-4",children:[e.jsx("div",{className:"bg-red-100 p-3 rounded-lg",children:e.jsx(G,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-700 text-sm",children:"Ruptures"}),e.jsx("p",{className:"text-xl font-semibold text-red-800",children:C})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-700 mt-8 mb-4",children:"Stock total par catégorie"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:R.map(t=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.nom}),e.jsx("p",{className:"text-sm text-gray-500",children:"Quantité totale en stock"})]}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:t.quantite})]},t.id))})]}),e.jsxs("div",{className:"flex gap-6 mb-6 p-2 bg-white border border-gray-300 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold text-amber-700 mb-1",children:"Seuil stock faible"}),e.jsx("input",{type:"number",min:s+1,value:a,onChange:t=>u(Math.max(s+1,Number(t.target.value))),className:"border border-gray-300 rounded px-3 py-1 w-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold text-red-700 mb-1",children:"Seuil rupture de stock"}),e.jsx("input",{type:"number",min:0,value:s,onChange:t=>i(Math.max(0,Number(t.target.value))),className:"border border-gray-300 rounded px-3 py-1 w-32"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-green-700",children:"Stock Normal"}),f.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en stock normal"}),f.map(t=>{const n=p(t.quantityStock);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Réf: ",t.reference]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix d'achat : ",e.jsxs("span",{className:"text-orange-600",children:[t.price_buy.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix de vente : ",e.jsxs("span",{className:"text-green-600",children:[t.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Quantité en stock : ",e.jsx("span",{className:"font-bold",children:t.quantityStock})]}),e.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded-full font-medium ${n.color}`,children:n.label})]},t.id)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-amber-700",children:"Stock Faible"}),N.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en stock faible"}),N.map(t=>{const n=p(t.quantityStock);return e.jsxs("div",{className:"bg-amber-50 rounded-xl shadow-sm border p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Réf: ",t.reference]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix d'achat : ",e.jsxs("span",{className:"text-orange-600",children:[t.price_buy.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix de vente : ",e.jsxs("span",{className:"text-green-600",children:[t.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Quantité en stock : ",e.jsx("span",{className:"font-bold",children:t.quantityStock})]}),e.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded-full font-medium ${n.color}`,children:n.label})]},t.id)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-red-700",children:"Stock Rupture"}),v.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun produit en rupture de stock"}),v.map(t=>{const n=p(t.quantityStock);return e.jsxs("div",{className:"bg-red-50 rounded-xl shadow-sm border p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Réf: ",t.reference]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix d'achat : ",e.jsxs("span",{className:"text-orange-600",children:[t.price_buy.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:["Prix de vente : ",e.jsxs("span",{className:"text-green-600",children:[t.price_sell.toFixed(2)," MAD"]})]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Quantité en stock : ",e.jsx("span",{className:"font-bold",children:t.quantityStock})]}),e.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded-full font-medium ${n.color}`,children:n.label})]},t.id)})]})]}),e.jsx(B,{isOpen:d,onClose:x,title:"Réapprovisionner le stock",children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produit"}),e.jsxs("select",{required:!0,value:r.produitId,onChange:t=>c({...r,produitId:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez un produit"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Point de vente"}),e.jsxs("select",{required:!0,value:r.pointVenteId,onChange:t=>c({...r,pointVenteId:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez un point de vente"}),I.map(t=>e.jsx("option",{value:t.id,children:t.nom},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantité à ajouter"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",required:!0,value:r.quantite,onChange:t=>c({...r,quantite:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:x,children:"Annuler"}),e.jsx(h,{type:"submit",loading:y.isLoading,children:"Réapprovisionner"})]})]})})]})};export{ce as default};
