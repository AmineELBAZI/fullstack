import{c as p,r as u,u as z,j as e}from"./index-yrzGcrsz.js";import{a as c}from"./axiosInstance-Cz6MWCIH.js";import{P as F}from"./PointsVenteApi-D-qlhskv.js";import{P as B,M as O}from"./Modal-CRmXHlMq.js";import{B as j}from"./Button-CeNaAo-j.js";import{L as Q}from"./LoadingSpinner-xF3CygPc.js";import{V as n}from"./index-CyOt5fqF.js";import{u as U}from"./useQuery-CZB9O9Qr.js";import{u as v}from"./useMutation-DpsCt41A.js";import{S as T}from"./search-B1HlV7q8.js";import{S as G}from"./square-pen-CXHSDyXI.js";import{T as K}from"./trash-2-DLPNPXD6.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=p("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=p("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=p("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=p("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),d="/users",x={getAll:()=>c.get(d),getById:r=>c.get(`${d}/${r}`),create:r=>c.post(`${d}/create`,r),update:(r,h)=>c.put(`${d}/${r}`,h),delete:r=>c.delete(`${d}/${r}`)},ne=()=>{const[r,h]=u.useState(""),[D,N]=u.useState(!1),[l,f]=u.useState(null),[g,w]=u.useState(!1),[a,i]=u.useState({username:"",password:"",role:"VENDEUR",boutique:null,active:!0}),b=z(),{data:A=[],isLoading:R}=U({queryKey:["utilisateurs"],queryFn:()=>x.getAll().then(s=>s.data)}),{data:q=[]}=U({queryKey:["points-vente"],queryFn:()=>F.getAllPointsVente().then(s=>s.data)}),E=v(x.create,{onSuccess:()=>{b.invalidateQueries(["utilisateurs"]),n.success("Utilisateur créé avec succès"),m()},onError:()=>{n.error("Erreur lors de la création de l'utilisateur")}}),M=v(({id:s,...t})=>x.update(s,t),{onSuccess:()=>{b.invalidateQueries(["utilisateurs"]),n.success("Utilisateur modifié avec succès"),m()},onError:()=>{n.error("Erreur lors de la modification de l'utilisateur")}}),I=v(x.delete,{onSuccess:()=>{b.invalidateQueries(["utilisateurs"]),n.success("Utilisateur supprimé avec succès")},onError:()=>{n.error("Erreur lors de la suppression de l'utilisateur")}}),S=A.filter(s=>s.username.toLowerCase().includes(r.toLowerCase())),k=(s=null)=>{s?(f(s),i({username:s.username,password:"",role:s.role,boutique:s.boutique||null,active:!0})):(f(null),i({username:"",password:"",role:"VENDEUR",boutique:null,active:!0})),N(!0)},m=()=>{N(!1),f(null),w(!1),i({username:"",password:"",role:"VENDEUR",boutique:null,active:!0})},L=s=>{s.preventDefault();const t={...a};if(l&&!t.password&&delete t.password,t.role==="VENDEUR"){if(!t.boutique||!t.boutique.id){n.error("Le vendeur doit être associé à une boutique.");return}t.boutique={id:t.boutique.id}}else t.boutique=null;l?M.mutate({id:l.id,...t}):E.mutate(t)},$=s=>{window.confirm("Voulez-vous vraiment supprimer cet utilisateur ?")&&I.mutate(s)},P=s=>s==="ADMIN"?_:V,C=s=>s==="ADMIN"?"text-blue-600 bg-blue-50":"text-green-600 bg-green-50";return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Q,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des utilisateurs"}),e.jsx("p",{className:"text-gray-600",children:"Gérez les comptes administrateurs et vendeurs"})]}),e.jsxs(j,{onClick:()=>k(),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Nouvel utilisateur"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:r,onChange:s=>h(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(s=>{const t=P(s.role),o=q.find(y=>s.boutique&&y.id===s.boutique.id);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border-2 p-6 transition-all border-gray-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${C(s.role)}`,children:e.jsx(t,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900",children:s.username})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>k(s),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Modifier",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Rôle:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize ${C(s.role)}`,children:s.role==="ADMIN"?"Administrateur":"Vendeur"})]}),s.role==="VENDEUR"&&o&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Boutique:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.nom})]})]})]},s.id)})}),S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur trouvé"})]}),e.jsx(O,{isOpen:D,onClose:m,title:l?"Modifier l'utilisateur":"Nouvel utilisateur",children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom d'utilisateur"}),e.jsx("input",{id:"username",type:"text",required:!0,value:a.username,onChange:s=>i({...a,username:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: jean.dupont"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:l?"Nouveau mot de passe (laisser vide pour ne pas changer)":"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:g?"text":"password",required:!l,value:a.password,onChange:s=>i({...a,password:s.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>w(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?e.jsx(H,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:"Rôle"}),e.jsxs("select",{id:"role",value:a.role,onChange:s=>{const t=s.target.value;i(o=>({...o,role:t,boutique:t==="VENDEUR"?o.boutique:null}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"VENDEUR",children:"Vendeur"}),e.jsx("option",{value:"ADMIN",children:"Administrateur"})]})]}),a.role==="VENDEUR"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"boutique",className:"block text-sm font-medium text-gray-700 mb-2",children:"Boutique assignée"}),e.jsxs("select",{id:"boutique",required:!0,value:a.boutique?.id||"",onChange:s=>{const t=s.target.value,o=t?{id:parseInt(t,10)}:null;i(y=>({...y,boutique:o}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sélectionnez une boutique"}),q.map(s=>e.jsx("option",{value:s.id,children:s.nom},s.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(j,{variant:"outline",onClick:m,children:"Annuler"}),e.jsx(j,{type:"submit",loading:E.isLoading||M.isLoading,children:l?"Modifier":"Créer"})]})]})})]})};export{ne as default};
