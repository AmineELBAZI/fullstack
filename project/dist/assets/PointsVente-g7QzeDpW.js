import{c as G,u as K,r as i,j as e,d as Z}from"./index-yrzGcrsz.js";import{P as a}from"./PointsVenteApi-D-qlhskv.js";import{p as $}from"./produitApi-qwVbZCBa.js";import{P as H,M as S}from"./Modal-CRmXHlMq.js";import{B as o}from"./Button-CeNaAo-j.js";import{L as J}from"./LoadingSpinner-xF3CygPc.js";import{V as r}from"./index-CyOt5fqF.js";import{u as U}from"./useQuery-CZB9O9Qr.js";import{u as d}from"./useMutation-DpsCt41A.js";import{S as W}from"./square-pen-CXHSDyXI.js";import{T as M}from"./trash-2-DLPNPXD6.js";import"./axiosInstance-Cz6MWCIH.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=G("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),ce=()=>{const l=K(),[w,u]=i.useState(!1),[c,x]=i.useState(null),[n,m]=i.useState({nom:"",adresse:""}),[v,N]=i.useState(null),[E,p]=i.useState(!1),[A,V]=i.useState([]),[h,j]=i.useState(null),[f,g]=i.useState(1),{data:q=[],isLoading:B,error:C}=U({queryKey:["pointsVente"],queryFn:()=>a.getAllPointsVente().then(t=>t.data)}),k=d({mutationFn:a.createPointVente,onSuccess:()=>{l.invalidateQueries(["pointsVente"]),r.success("Point de vente créé"),u(!1)},onError:()=>r.error("Erreur lors de la création")}),D=d({mutationFn:({id:t,data:s})=>a.updatePointVente(t,s),onSuccess:()=>{l.invalidateQueries(["pointsVente"]),r.success("Point de vente modifié"),u(!1)},onError:()=>r.error("Erreur lors de la modification")}),I=d({mutationFn:a.deletePointVente,onSuccess:()=>{l.invalidateQueries(["pointsVente"]),r.success("Point de vente supprimé"),N(null)},onError:()=>r.error("Erreur suppression")}),Q=d({mutationFn:({boutiqueId:t,produitId:s,quantity:_})=>a.ajouterProduit(t,{produitId:s,quantity:_}),onSuccess:()=>{l.invalidateQueries(["pointsVente"]),r.success("Produit ajouté"),p(!1)},onError:t=>{const s=t?.response?.data||"Erreur lors de l'ajout du produit.";r.error(s)}}),L=d({mutationFn:({boutiqueId:t,produitId:s})=>a.supprimerProduit(t,s),onSuccess:()=>{l.invalidateQueries(["pointsVente"]),r.success("Produit supprimé")},onError:()=>r.error("Erreur suppression produit")}),y=(t=null)=>{t?(x(t),m({nom:t.nom,adresse:t.adresse})):(x(null),m({nom:"",adresse:""})),u(!0)},b=()=>{u(!1),x(null)},F=t=>{N(t),j(null),g(1),p(!0),$.getEnRupture().then(s=>V(s.data)).catch(()=>r.error("Erreur chargement produits disponibles"))},P=()=>{p(!1),j(null),g(1)},T=t=>{t.preventDefault(),c?D.mutate({id:c.id,data:n}):k.mutate(n)},z=t=>{if(t.preventDefault(),!v||!h){r.error("Veuillez sélectionner un produit.");return}if(f<=0){r.error("Veuillez saisir une quantité valide.");return}Q.mutate({boutiqueId:v,produitId:h,quantity:f})},R=t=>{window.confirm(`Supprimer ce point de vente ?

Les quantités de stock associées seront réintégrées au stock général des produits.`)&&I.mutate(t)},O=(t,s)=>{window.confirm("Supprimer ce produit ?")&&L.mutate({boutiqueId:t,produitId:s})};return B?e.jsx(J,{size:"lg"}):C?e.jsx("div",{className:"text-red-500 text-center py-6",children:"Erreur chargement"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Points de vente"}),e.jsx("p",{className:"text-gray-500",children:"Gérez vos points de vente"})]}),e.jsxs(o,{onClick:()=>y(),children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," Ajouter un point de vente"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(t=>e.jsxs("div",{className:"bg-gradient-to-br from-white via-sky-50 to-slate-100 border border-gray-200 rounded-2xl shadow-xl p-5 transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-6 h-6 text-sky-700"}),e.jsx("h2",{className:"text-lg font-semibold text-sky-800",children:t.nom})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4 mr-1 text-emerald-600"}),t.adresse]}),e.jsxs("span",{className:"inline-block text-xs bg-orange-100 text-orange-700 font-medium px-2 py-0.5 rounded-full",children:[t.stocks?.length??0," produit",(t.stocks?.length??0)>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(t),title:"Modifier",children:e.jsx(W,{className:"w-5 h-5 text-blue-500 hover:text-blue-700 transition"})}),e.jsx("button",{onClick:()=>R(t.id),title:"Supprimer",children:e.jsx(M,{className:"w-5 h-5 text-red-500 hover:text-red-700 transition"})})]})]}),e.jsxs("div",{className:"mt-4 bg-white rounded-xl shadow-inner p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Produits"}),!t.stocks||t.stocks.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"Aucun produit"}):e.jsx("ul",{className:"space-y-2",children:t.stocks.map(s=>s.produit&&e.jsxs("li",{className:"flex justify-between items-start bg-gray-50 border border-orange-200 p-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:s.produit.name}),e.jsxs("div",{className:"text-sm",children:["État :"," ",e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-semibold rounded-full
                                ${s.status==="VALIDATED"?"bg-green-100 text-green-700":s.status==="NOT_VALIDATED"?"bg-red-100 text-red-700":"bg-red-300 text-red-700"}`,children:s.status==="VALIDATED"?"Validé":s.status==="NOT_VALIDATED"?"Non validé":s.status})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Réf: ",s.produit.reference]}),e.jsxs("div",{className:"text-sm text-green-600",children:[s.produit.price_sell," MAD"]}),e.jsxs("div",{className:"text-sm",children:["Qté en boutique: ",s.quantity]})]}),e.jsx("button",{onClick:()=>O(t.id,s.produit.id),title:"Supprimer produit",children:e.jsx(M,{className:"w-4 h-4 text-red-500 hover:text-red-700"})})]},s.id))}),e.jsx(o,{className:"mt-3",size:"sm",onClick:()=>F(t.id),children:"Ajouter un produit"})]})]},t.id))}),e.jsx(S,{isOpen:w,onClose:b,title:c?"Modifier":"Créer",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nom"}),e.jsx("input",{required:!0,value:n.nom,onChange:t=>m({...n,nom:t.target.value}),className:"w-full border px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Adresse"}),e.jsx("textarea",{required:!0,value:n.adresse,onChange:t=>m({...n,adresse:t.target.value}),className:"w-full border px-3 py-2 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:b,children:"Annuler"}),e.jsx(o,{type:"submit",children:c?"Modifier":"Créer"})]})]})}),e.jsx(S,{isOpen:E,onClose:P,title:"Ajouter un produit",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Sélectionnez un produit"}),e.jsxs("select",{value:h||"",onChange:t=>j(Number(t.target.value)),required:!0,className:"w-full border p-2 rounded",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Choisir un produit --"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (Réf: ",t.reference,") - Prix: ",t.price_sell," MAD - Stock: ",t.quantityStock]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Quantité"}),e.jsx("input",{type:"number",min:"1",value:f,onChange:t=>g(Number(t.target.value)),required:!0,className:"w-full border px-3 py-2 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:P,children:"Annuler"}),e.jsx(o,{type:"submit",children:"Ajouter"})]})]})})]})};export{ce as default};
